/*
 * Copyright 2014 Plugin developer. 
 */
//***MULTI-PART
//*******************
//LOGICAL-PATH:atplugins/tabletemplate/Table.tpl
//*******************
Aria.classDefinition({$classpath:"atplugins.tabletemplate.Table",$extends:"aria.templates.Template",$constructor:function(){this.$Template.constructor.call(this),this.$TableScript.constructor.call(this)},$destructor:function(){this.$TableScript.$destructor.call(this),this.$Template.$destructor.call(this)},$dependencies:["aria.widgets.AriaLib","atplugins.tabletemplate.TableScript","aria.templates.View","aria.utils.String","aria.widgets.form.RadioButton","aria.widgets.action.SortIndicator"],$css:["atplugins.tabletemplate.TableStyle"],$prototype:{macro_main:function(){try{with(this)this._cfgOk&&this.__$insertSection(25,{id:this.cfg.tableSectionId||this.TABLE_SECTION_ID,tableNav:!0,macro:{name:"writeTable"},bindRefreshTo:[{to:"items",inside:data.table,recursive:!0}]})}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["main",this["aria:currentLineNumber"]],_ex)}},macro_callMacro:function(name,args){try{with(this)this["macro_"+name]?this.__$write(this.$modifier("escapeforhtml",[this["macro_"+name].apply(this,args)]),42):this.__$write(this.$modifier("escapeforhtml",[this.$logError(this.MACRO_NOT_FOUND,name)]),44)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["callMacro",this["aria:currentLineNumber"]],_ex)}},macro_writeTable:function(){try{with(this)this.cfg.filtering.active&&(this.cfg.filtering.macro?this.macro_callMacro(this.cfg.filtering.macro,[this.itemsView]):this.macro_writeFilters(this.cfg.filtering.filters)),this.cfg.paging.active&&this.cfg.paging.position==this.FILTER_POSITION_TOP&&this.macro_writePaginator(),this.macro_openTable(),this.macro_writeTableHeader(),this.macro_writeTableBody(),this.macro_closeTable(),this.__$write("\n\n<br />\n\n",66),this.cfg.paging.active&&this.cfg.paging.position==this.FILTER_POSITION_BOTTOM&&this.macro_writePaginator()}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTable",this["aria:currentLineNumber"]],_ex)}},macro_openTable:function(){try{with(this)this.__$write("\n<table ",75),this.macro_writeTableAttributes(),this.__$write(" >\n",75)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["openTable",this["aria:currentLineNumber"]],_ex)}},macro_closeTable:function(){try{with(this)this.__$write("\n</table>\n",79)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["closeTable",this["aria:currentLineNumber"]],_ex)}},macro_writeTableAttributes:function(){try{with(this)this.macro_writeTableId(),this.macro_writeCssClasses(this.cfg.cssClasses||[])}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableAttributes",this["aria:currentLineNumber"]],_ex)}},macro_writeTableId:function(){try{with(this)this.cfg.tableId&&(this.__$write('\nid="',89),this.__$write(this.$modifier("escapeforhtml",[this.cfg.tableId]),89),this.__$write('"\n',89))}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableId",this["aria:currentLineNumber"]],_ex)}},macro_writeCssClasses:function(cssClasses){try{with(this)cssClasses&&cssClasses.length>0&&(this.__$write('\nclass="',95),this.__$write(this.$modifier("escapeforhtml",[cssClasses.join(" ")]),95),this.__$write('"\n',95))}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeCssClasses",this["aria:currentLineNumber"]],_ex)}},macro_writeFilters:function(filters){try{with(this){this.__$write('\n<div class="filters">\n',100);var __v_1=filters;void 0==filters&&this.$logError(this.ITERABLE_UNDEFINED,["foreach",101]);for(var filter_ct=0,__v_2=__v_1.length,filter_index=0;__v_2>filter_index;filter_index++){var filter=__v_1[filter_index];filter_ct++,this.__$processWidgetMarkup("aria.widgets.AriaLib","RadioButton",{label:filter.label,keyValue:filter.keyValue,onchange:{fn:_wrapFilterFunction,args:{fn:filter.fn,view:this.itemsView}},bind:{value:{inside:this.cfg.filtering,to:this.FILTER_DEFAULT_BINDING_GROUP}}},102)}this.__$write("\n</div>\n",114)}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeFilters",this["aria:currentLineNumber"]],_ex)}},macro_writeTableHeader:function(){try{with(this)this.__$write("\n<thead>\n",118),this.macro_writeTableHeaderRowContent(),this.__$write("\n</thead>\n",120)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableHeader",this["aria:currentLineNumber"]],_ex)}},macro_openTableHeaderRow:function(){try{with(this)this.__$write("\n<tr>\n",124)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["openTableHeaderRow",this["aria:currentLineNumber"]],_ex)}},macro_closeTableHeaderRow:function(){try{with(this)this.__$write("\n</tr>\n",128)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["closeTableHeaderRow",this["aria:currentLineNumber"]],_ex)}},macro_writeTableHeaderRowContent:function(){try{with(this){this.macro_openTableHeaderRow();var __v_3=this.cfg.columns;void 0==this.cfg.columns&&this.$logError(this.ITERABLE_UNDEFINED,["foreach",133]);for(var col_ct=0,__v_4=__v_3.length,col_index=0;__v_4>col_index;col_index++){var col=__v_3[col_index];col_ct++,this.macro_writeTableHeaderContent(col)}this.macro_closeTableHeaderRow()}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableHeaderRowContent",this["aria:currentLineNumber"]],_ex)}},macro_writeTableHeaderContent:function(col){try{with(this){var cssClasses=["th-"+col.name.toLowerCase()];col.cssClasses&&col.cssClasses.length>0&&(cssClasses=cssClasses.concat(col.cssClasses)),this.macro_openTableHeader(cssClasses,col),this.macro_writeHeaderRowContent(col),this.macro_closeTableHeader(col)}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableHeaderContent",this["aria:currentLineNumber"]],_ex)}},macro_openTableHeader:function(cssClasses,col){try{with(this)this.__$write("\n<th ",154),this.macro_writeCssClasses(cssClasses),this.__$write(">\n",154)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["openTableHeader",this["aria:currentLineNumber"]],_ex)}},macro_writeHeaderRowContent:function(col){try{with(this)col.sortable?this.macro_createSortIndicator(this.SORTING_DEFAULT_NAME_PREFIX+col.name,col.name,col.sortFunction||this._createDefaultSortFunction(col),this.itemsView):this.__$write(this.$modifier("escapeforhtml",[col.name]),162)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeHeaderRowContent",this["aria:currentLineNumber"]],_ex)}},macro_closeTableHeader:function(col){try{with(this)this.__$write("\n</th>\n",167)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["closeTableHeader",this["aria:currentLineNumber"]],_ex)}},macro_writeTableBody:function(){try{with(this)this.__$write("\n<tbody>\n",171),this.macro_writeTableBodyContent(),this.__$write("\n</tbody>\n",173)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableBody",this["aria:currentLineNumber"]],_ex)}},macro_writeTableBodyContent:function(){try{with(this){var __v_5=this.itemsView;void 0==this.itemsView&&this.$logError(this.ITERABLE_UNDEFINED,["foreach",177]);var rowData_ct=0;__v_5.refresh();for(var __v_7=__v_5.currentPageIndex,__v_6=__v_5.pages[__v_7].lastItemIndex,rowData_index=__v_5.pages[__v_7].firstItemIndex;__v_6>=rowData_index;rowData_index++){var rowData_info=__v_5.items[rowData_index];if(rowData_info.pageIndex==__v_7){var rowData=rowData_info.value;rowData_ct++,this.macro_writeTableRow(rowData,rowData_info.initIndex)}}}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableBodyContent",this["aria:currentLineNumber"]],_ex)}},macro_createSortIndicator:function(sortName,label,sortKeyGetter){try{with(this)this.__$processWidgetMarkup("aria.widgets.AriaLib","SortIndicator",{sortName:sortName,label:label,view:this.itemsView,sortKeyGetter:sortKeyGetter},183)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["createSortIndicator",this["aria:currentLineNumber"]],_ex)}},macro_writeTableRow:function(rowData,idx){try{with(this){var rowClass=0==idx%2?this.EVEN_ROW_STYLECLASS:this.ODD_ROW_STYLECLASS;rowData._tbl_selected?this.macro_openTableRow(idx,["row_"+idx,rowClass,this.SELECTED_ROW_STYLECLASS]):this.macro_openTableRow(idx,["row_"+idx,rowClass]),this.macro_writeTableRowContent(rowData),this.macro_closeTableRow(rowData,idx)}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableRow",this["aria:currentLineNumber"]],_ex)}},macro_openTableRow:function(rowIndex,cssClasses){try{with(this)this.__$write('\n<tr tabindex="',205),this.__$write(this.$modifier("escapeforhtml",[rowIndex]),205),this.__$write('" ',205),this.macro_writeCssClasses(cssClasses),this.__$write(" ",205),this.__$statementOnEvent("click",this.$normCallback({fn:takeSelection,args:{index:rowIndex}}),205),this.__$write(" ",205),this.__$statementOnEvent("mouseover",this.$normCallback("highlight"),205),this.__$write(" ",205),this.__$statementOnEvent("mouseout",this.$normCallback("unhighlight"),205),this.__$write(' data-index="',205),this.__$write(this.$modifier("escapeforhtml",[rowIndex]),205),this.__$write('">\n',205)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["openTableRow",this["aria:currentLineNumber"]],_ex)}},macro_writeTableRowContent:function(rowData){try{with(this){var __v_8=this.cfg.columns;void 0==this.cfg.columns&&this.$logError(this.ITERABLE_UNDEFINED,["foreach",209]);for(var col_ct=0,__v_9=__v_8.length,col_index=0;__v_9>col_index;col_index++){var col=__v_8[col_index];col_ct++,col.macro?this.macro_callMacro(col.macro,[rowData]):col.value&&(this.__$write("\n<td>",213),this.__$write(this.$modifier("escapeforhtml",[col.value(rowData)]),213),this.__$write("</td>\n",213))}}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writeTableRowContent",this["aria:currentLineNumber"]],_ex)}},macro_closeTableRow:function(rowData,idx){try{with(this)this.__$write("\n</tr>\n",219)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["closeTableRow",this["aria:currentLineNumber"]],_ex)}},macro_writePaginator:function(){try{with(this){this.__$write('\n<div class="',223),this.__$write(this.$modifier("escapeforhtml",[this.PAGINATOR_DIV_STYLECLASS]),223),this.__$write('">\n',223),this.macro_writePaginationControl(this.PAGINATOR_ACTION_FIRST,this.PAGINATOR_SYMBOL_FIRST),this.__$write("&nbsp;&nbsp;\n",224),this.macro_writePaginationControl(this.PAGINATOR_ACTION_PREV,this.PAGINATOR_SYMBOL_PREV),this.__$write("&nbsp;\n\n\n",225),this.__$write(this.$modifier("escapeforhtml",[this.itemsView.refresh()]),228);var __v_10=this.itemsView.pages;void 0==this.itemsView.pages&&this.$logError(this.ITERABLE_UNDEFINED,["foreach",229]);var page_ct=0;for(var page_index in __v_10)if(__v_10.hasOwnProperty(page_index)&&!this.$json.isMetadata(page_index)){var page=__v_10[page_index];page_ct++,page_ct>1&&this.__$write("&nbsp;|&nbsp;",230),this.__$write("\n<a ",231),this.__$statementOnEvent("click",this.$normCallback({fn:showPage,args:page.pageIndex}),231),this.__$write(">\n",231),page.pageIndex==this.itemsView.currentPageIndex&&(this.__$write('\n<span class="',233),this.__$write(this.$modifier("escapeforhtml",[this.PAGINATOR_ACTIVE_STYLECLASS]),233),this.__$write('">\n',233)),this.__$write(this.$modifier("escapeforhtml",[page.firstItemNumber]),235),this.__$write("-",235),this.__$write(this.$modifier("escapeforhtml",[page.lastItemNumber]),235),page.pageIndex==this.itemsView.currentPageIndex&&this.__$write("\n</span>\n",237),this.__$write("\n</a>\n",239)}this.__$write("&nbsp;\n\n",240),this.macro_writePaginationControl(this.PAGINATOR_ACTION_NEXT,this.PAGINATOR_SYMBOL_NEXT),this.__$write("&nbsp;&nbsp;\n",242),this.macro_writePaginationControl(this.PAGINATOR_ACTION_LAST,this.PAGINATOR_SYMBOL_LAST),this.__$write("\n</div>\n",244)}}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writePaginator",this["aria:currentLineNumber"]],_ex)}},macro_writePaginationControl:function(action,text){try{with(this)this.__$write('\n<span class="',248),this.__$write(this.$modifier("escapeforhtml",[this.PAGINATOR_CTRL_STYLECLASS]),248),this.__$write('" ',248),this.__$statementOnEvent("click",this.$normCallback({fn:paginate,args:action}),248),this.__$write(">",248),this.__$write(this.$modifier("escapeforhtml",[text]),248),this.__$write("</span>\n",248)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["writePaginationControl",this["aria:currentLineNumber"]],_ex)}},$init:function(t){t.__$macrolibs={},t.__$width={},t.__$height={},aria.core.TplClassLoader._importScriptPrototype(atplugins.tabletemplate.TableScript,t)},__$initTemplate:function(){try{with(this)this.itemsView=this.__$createView("itemsView",[],data.table.items)}catch(_ex){return this.$logError(this.EXCEPTION_IN_VARINIT,[this.$classpath],_ex),!1}return!0}}});
//*******************
//LOGICAL-PATH:atplugins/tabletemplate/TableCfgBeans.js
//*******************
Aria.beanDefinitions({$package:"atplugins.tabletemplate.TableCfgBeans",$namespaces:{json:"aria.core.JsonTypes"},$beans:{TableCfg:{$type:"json:Object",$properties:{items:{$type:"json:Array",$contentType:{$type:"json:ObjectRef"}},config:{$type:"config"}}},config:{$type:"json:Object",$properties:{tableId:{$type:"json:String"},tableSectionId:{$type:"json:String",$default:"__table__section"},columns:{$type:"json:Array",$contentType:{$type:"ColumnCfg"}},cssClasses:{$type:"json:Array",$contentType:{$type:"json:String"}},filtering:{$type:"TableFilterCfg",$default:{}},paging:{$type:"TablePagingCfg",$default:{}},selection:{$type:"TableSelectionCfg",$default:{}}}},TableFilterCfg:{$type:"json:Object",$properties:{active:{$type:"json:Boolean",$default:!1},filters:{$type:"json:Array",$contentType:{$type:"FilterCfg"}},macro:{$type:"json:String"},filterGroup:{$type:"json:String",$default:"all"}}},FilterCfg:{$type:"json:Object",$properties:{label:{$type:"json:String",$mandatory:!0},keyValue:{$type:"json:String",$mandatory:!0},fn:{$type:"json:FunctionRef"}}},TablePagingCfg:{$type:"json:Object",$properties:{active:{$type:"json:Boolean",$default:!1},position:{$type:"json:Enum",$enumValues:["bottom","top"],$default:"bottom"},pageSize:{$type:"json:Integer",$default:15}}},TableSelectionCfg:{$type:"json:Object",$properties:{active:{$type:"json:Boolean",$default:!0},multiple:{$type:"json:Boolean",$default:!1}}},ColumnCfg:{$type:"json:Object",$properties:{name:{$type:"json:String",$mandatory:!0},cssClasses:{$type:"json:Array",$contentType:{$type:"json:String"}},value:{$type:"json:FunctionRef"},sortable:{$type:"json:Boolean",$default:!1},sortFunction:{$type:"json:FunctionRef"},macro:{$type:"json:String"}}}}});
//*******************
//LOGICAL-PATH:atplugins/tabletemplate/TableScript.js
//*******************
Aria.tplScriptDefinition({$classpath:"atplugins.tabletemplate.TableScript",$statics:{INVALID_CONFIGURATION:"Invalid configuration for the Table.",MACRO_NOT_FOUND:"Macro %1 could not be found",TABLE_SECTION_ID:"__table__section",SELECTED_ROW_ATTRIBUTE:"_tbl_selected",HIGHLIGHTED_ROW_STYLECLASS:"highlighted",EVEN_ROW_STYLECLASS:"even",ODD_ROW_STYLECLASS:"odd",SELECTED_ROW_STYLECLASS:"selected",FILTER_POSITION_TOP:"top",FILTER_POSITION_BOTTOM:"bottom",FILTER_DEFAULT_BINDING_GROUP:"filterGroup",SORTING_DEFAULT_NAME_PREFIX:"SortBy",PAGINATOR_DIV_STYLECLASS:"paginator",PAGINATOR_CTRL_STYLECLASS:"nav",PAGINATOR_ACTIVE_STYLECLASS:"active",PAGINATOR_SYMBOL_FIRST:"<<",PAGINATOR_SYMBOL_PREV:"<",PAGINATOR_SYMBOL_NEXT:">",PAGINATOR_SYMBOL_LAST:">>",PAGINATOR_ACTION_FIRST:"first",PAGINATOR_ACTION_PREV:"prev",PAGINATOR_ACTION_NEXT:"next",PAGINATOR_ACTION_LAST:"last"},$dependencies:["atplugins.tabletemplate.TableCfgBeans"],$constructor:function(){this.selectedIndices=[]},$destructor:function(){this.itemsView.$dispose(),this.selectedIndices=null},$prototype:{_cfgBean:"atplugins.tabletemplate.TableCfgBeans.TableCfg",$dataReady:function(){var t={beanName:this._cfgBean,json:this.data.table};this._cfgOk=aria.core.JsonValidator.normalize(t,!1),this._cfgOk&&(this.cfg=this.data.table.config,this.setPageSize(),this._resetSelection())},setPageSize:function(){this.cfg.paging.active&&this.itemsView.setPageSize(this.cfg.paging.pageSize)},highlight:function(t){var e=t.target.getParentWithName("tr");e.classList.add(this.HIGHLIGHTED_ROW_STYLECLASS),e.$dispose()},unhighlight:function(t){var e=t.target.getParentWithName("tr");e.classList.remove(this.HIGHLIGHTED_ROW_STYLECLASS),e.$dispose()},showPage:function(t,e){var i=this.itemsView;return i.currentPageIndex=e,this._refreshTable(),!1},paginate:function(t,e){var i=this.itemsView.currentPageIndex;switch(e){case this.PAGINATOR_ACTION_FIRST:i=0;break;case this.PAGINATOR_ACTION_PREV:i>0&&i--;break;case this.PAGINATOR_ACTION_NEXT:this.itemsView.pages.length-1>i&&i++;break;case this.PAGINATOR_ACTION_LAST:i=this.itemsView.pages.length-1;break;default:i=0}return this.itemsView.currentPageIndex=i,this._refreshTable(),!1},takeSelection:function(t,e){if(this.cfg.selection.active){var i=e.index,s=this.itemsView,r=this.itemsView.initialArray,a=this.cfg.selection.lastSelectedIdx;if(t.shiftKey)if(void 0!==a){if(i==a)this._setSelection(i,!r[i]._tbl_selected);else if(a>=s.pages[s.currentPageIndex].firstItemNumber-1&&s.pages[s.currentPageIndex].lastItemNumber-1>=a)if(a>i)for(var n=i;a>n;n++)this._setSelection(i,!0);else if(i>a)for(var n=a;i>=n;n++)this._setSelection(n,!0)}else this._setSelection(i,!0);else if(this.cfg.selection.multiple)this._setSelection(i,!r[i]._tbl_selected);else if(t.ctrlKey)this._setSelection(i,!r[i]._tbl_selected);else{var o=!r[i]._tbl_selected;this._resetSelection(),this._setSelection(i,o)}this.cfg.selection.lastSelectedIdx=i}},getSelectedIndices:function(){return this.cfg.selection.selectedIndices||[]},_setSelection:function(t,e){this.cfg.selection.selectedIndices||(this.cfg.selection.selectedIndices=[]),e?this.cfg.selection.selectedIndices.push(t):this.cfg.selection.selectedIndices.splice(this.cfg.selection.selectedIndices.indexOf(t),1),this.$json.setValue(this.itemsView.initialArray[t],this.SELECTED_ROW_ATTRIBUTE,e)},_resetSelection:function(){if(this.cfg.selection.selectedIndices)for(;this.cfg.selection.selectedIndices.length>0;)this._setSelection(this.cfg.selection.selectedIndices[0],!1)},_refreshTable:function(){this.$refresh({section:this.cfg.tableSectionId})},_createDefaultSortFunction:function(t){return function(e){return t.value(e.value)}},_wrapFilterFunction:function(t,e){e.fn.apply(this,[e.view]),this._refreshTable()}}});
//*******************
//LOGICAL-PATH:atplugins/tabletemplate/TableStyle.tpl.css
//*******************
Aria.classDefinition({$classpath:"atplugins.tabletemplate.TableStyle",$extends:"aria.templates.CSSTemplate",$constructor:function(){this.$CSSTemplate.constructor.call(this)},$destructor:function(){this.$CSSTemplate.$destructor.call(this)},$prototype:{macro_main:function(){try{with(this)this.__$write("\n\np {\nfont-weight: bold;\n}\n\ntable {\nfont-size: ",12),this.__$write(fontSize,18),this.__$write(";\npadding: 0;\nmargin: 0;\nborder-spacing:0;\nborder-collapse:collapse;\n}\n\ntable tr {\ncursor : pointer;\n}\n\nth {\ntext-align: left;\nbackground-color: ",18),this.__$write(greyColor,31),this.__$write(";\npadding: ",31),this.__$write(contentPadding,32),this.__$write(";\nborder: 1px solid ",32),this.__$write(greyColor,33),this.__$write(";\n}\n\ntd {\ntext-align: left;\npadding: ",33),this.__$write(contentPadding,38),this.__$write(";\nborder: 1px solid ",38),this.__$write(greyColor,39),this.__$write(";\ntext-align: left;\npadding: ",39),this.__$write(contentPadding,41),this.__$write(";\nmargin: 0;\n}\n\n.smaller {font-size: 11px; font-weight: bold;}\n\n.paginator .nav, .paginator a {\ncursor: pointer;\n}\n\n.paginator a .active {\nfont-weight:bold;\n}\n\n.highlighted {background-color: #E9F1F7; color: black;}\n\n.selected {background-color: #FFCC66; color:white;}\n",41)}catch(_ex){this.$logError(this.EXCEPTION_IN_MACRO,["main",this["aria:currentLineNumber"]],_ex)}},$init:function(t){t.__$csslibs={},t.__$prefix=!0},__$initTemplate:function(){try{with(this)this.greyColor="#DFDFDF",this.fontSize="13px",this.contentPadding="5px"}catch(_ex){return this.$logError(this.EXCEPTION_IN_VARINIT,[this.$classpath],_ex),!1}return!0}}});